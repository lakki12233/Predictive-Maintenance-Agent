<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predictive Maintenance Agent - Test UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 14px;
        }
        
        .api-config {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .api-config h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .api-config input {
            width: 300px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .status-indicator.ok {
            background: #10b981;
            box-shadow: 0 0 8px #10b981;
        }
        
        .status-indicator.error {
            background: #ef4444;
            box-shadow: 0 0 8px #ef4444;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }
        
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .test-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .test-card p {
            color: #666;
            font-size: 13px;
            margin-bottom: 15px;
        }
        
        .test-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .test-button:hover {
            opacity: 0.9;
        }
        
        .test-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            display: none;
        }
        
        .result.success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }
        
        .result.error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        
        .result.loading {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1e40af;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .result-data {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .metric {
            display: inline-block;
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 8px;
            margin-top: 5px;
            font-size: 12px;
        }
        
        .metric strong {
            color: #667eea;
        }
        
        .image-preview {
            margin-top: 10px;
            max-width: 100%;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
        }
        
        .run-all-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 15px 30px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge.sensor {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .badge.image {
            background: #fce7f3;
            color: #9f1239;
        }
        
        .badge.env {
            background: #d1fae5;
            color: #065f46;
        }
        
        .badge.batch {
            background: #fef3c7;
            color: #92400e;
        }
        
        .badge.vlm {
            background: #ede9fe;
            color: #5b21b6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Predictive Maintenance Agent</h1>
            <p>Multimodal AI System for Pump Failure Prediction | Sensor + Image + Environmental Context</p>
        </div>
        
        <div class="api-config">
            <h3>API Configuration</h3>
            <label>
                Base URL: 
                <input type="text" id="baseUrl" value="http://localhost:8000" />
                <button onclick="checkHealth()" style="padding: 10px 20px; margin-left: 10px; cursor: pointer; border: 1px solid #ddd; border-radius: 6px; background: white;">
                    Check Health
                </button>
                <span id="healthStatus"></span>
            </label>
        </div>
        
        <button class="test-button run-all-btn" onclick="runAllTests()">‚ñ∂ Run All Tests</button>
        
        <div class="test-grid">
            <!-- Test 1: Health Check -->
            <div class="test-card">
                <h3>üè• Health Check</h3>
                <p>Verify API is running and models are loaded</p>
                <button class="test-button" onclick="testHealth()">Run Test</button>
                <div class="result" id="result-health"></div>
            </div>
            
            <!-- Test 2: Sensor Only -->
            <div class="test-card">
                <h3>üìä Sensor Only <span class="badge sensor">SENSOR</span></h3>
                <p>Basic prediction using sensor data only (mandatory modality)</p>
                <button class="test-button" onclick="testSensorOnly()">Run Test</button>
                <div class="result" id="result-sensor"></div>
            </div>
            
            <!-- Test 3: Environmental Critical -->
            <div class="test-card">
                <h3>‚ö†Ô∏è Environmental - Critical <span class="badge sensor">SENSOR</span><span class="badge env">ENV</span></h3>
                <p>High-risk environmental conditions (overdue maintenance, extreme temperature)</p>
                <button class="test-button" onclick="testEnvCritical()">Run Test</button>
                <div class="result" id="result-env-critical"></div>
            </div>
            
            <!-- Test 4: Environmental Favorable -->
            <div class="test-card">
                <h3>‚úÖ Environmental - Favorable <span class="badge sensor">SENSOR</span><span class="badge env">ENV</span></h3>
                <p>Normal operating conditions with recent maintenance</p>
                <button class="test-button" onclick="testEnvFavorable()">Run Test</button>
                <div class="result" id="result-env-favorable"></div>
            </div>
            
            <!-- Test 5: Image Rust Detection -->
            <div class="test-card">
                <h3>ü¶Ä Image - Rust Detected <span class="badge sensor">SENSOR</span><span class="badge image">IMAGE</span></h3>
                <p>Visual inspection detects corrosion on pump surface</p>
                <button class="test-button" onclick="testImageRust()">Run Test</button>
                <div class="result" id="result-image-rust"></div>
            </div>
            
            <!-- Test 6: Image Clean -->
            <div class="test-card">
                <h3>‚ú® Image - Clean Surface <span class="badge sensor">SENSOR</span><span class="badge image">IMAGE</span></h3>
                <p>No rust detected, confidence below fusion threshold</p>
                <button class="test-button" onclick="testImageClean()">Run Test</button>
                <div class="result" id="result-image-clean"></div>
            </div>
            
            <!-- Test 7: Multimodal Complete -->
            <div class="test-card">
                <h3>üåê Multimodal Complete <span class="badge sensor">SENSOR</span><span class="badge image">IMAGE</span><span class="badge env">ENV</span></h3>
                <p>All three modalities: sensor + image + environmental fusion</p>
                <button class="test-button" onclick="testMultimodal()">Run Test</button>
                <div class="result" id="result-multimodal"></div>
            </div>
            
            <!-- Test 8: VLM Multimodal (CLIP) -->
            <div class="test-card">
                <h3>üß† VLM Multimodal (CLIP) <span class="badge sensor">SENSOR</span><span class="badge image">IMAGE</span><span class="badge env">ENV</span><span class="badge vlm">VLM</span></h3>
                <p>Vision-Language Model test with rust detection + all modalities</p>
                <button class="test-button" onclick="testVLMMultimodal()">Run Test</button>
                <div class="result" id="result-vlm-multimodal"></div>
            </div>
            
            <!-- Test 9: Batch Prediction -->
            <div class="test-card">
                <h3>üì¶ Batch Prediction <span class="badge batch">BATCH</span></h3>
                <p>Process multiple assets in a single request (3 pumps)</p>
                <button class="test-button" onclick="testBatch()">Run Test</button>
                <div class="result" id="result-batch"></div>
            </div>
        </div>
    </div>
    
    <script>
        const getBaseUrl = () => document.getElementById('baseUrl').value;
        
        // Show result helper
        function showResult(id, type, title, content) {
            const resultDiv = document.getElementById(`result-${id}`);
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `<div class="result-title">${title}</div><div class="result-data">${content}</div>`;
        }
        
        // Format prediction response
        function formatPrediction(data) {
            let html = '';
            html += `<div class="metric"><strong>Failure Prob:</strong> ${(data.failure_probability * 100).toFixed(1)}%</div>`;
            html += `<div class="metric"><strong>TTB:</strong> ${data.estimated_time_to_breakdown_hours.toFixed(0)}h</div>`;
            if (data.inference_ms) {
                html += `<div class="metric"><strong>Latency:</strong> ${data.inference_ms}ms</div>`;
            }
            if (data.predicted_fault_type) {
                html += `<br><strong>Fault:</strong> ${data.predicted_fault_type}`;
                html += ` <div class="metric"><strong>Confidence:</strong> ${(data.fault_confidence * 100).toFixed(1)}%</div>`;
            }
            if (data.top_signals && data.top_signals.length > 0) {
                html += `<br><strong>Top Signals:</strong> ${data.top_signals.slice(0, 3).join(', ')}`;
            }
            if (data.explanation) {
                html += `<br><br><strong>Explanation:</strong><br>${data.explanation}`;
            }
            return html;
        }
        
        // Check Health
        async function checkHealth() {
            const status = document.getElementById('healthStatus');
            try {
                const response = await fetch(`${getBaseUrl()}/health`);
                const data = await response.json();
                if (data.status === 'ok') {
                    status.innerHTML = '<span class="status-indicator ok"></span> Connected';
                } else {
                    status.innerHTML = '<span class="status-indicator error"></span> Error';
                }
            } catch (error) {
                status.innerHTML = '<span class="status-indicator error"></span> Offline';
            }
        }
        
        // Test 1: Health Check
        async function testHealth() {
            showResult('health', 'loading', '‚è≥ Loading...', 'Checking API health...');
            try {
                const response = await fetch(`${getBaseUrl()}/health`);
                const data = await response.json();
                showResult('health', 'success', '‚úÖ Success', 
                    `Status: ${data.status}\nModel Version: ${data.model_version}\nImage Model: ${data.image_model}`);
            } catch (error) {
                showResult('health', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 2: Sensor Only
        async function testSensorOnly() {
            showResult('sensor', 'loading', '‚è≥ Loading...', 'Testing sensor-only prediction...');
            const payload = {
                "asset_id": "pump_001",
                "timestamp": "2026-02-12T20:00:00Z",
                "sensor_window": [
                    {"ts":"2026-02-12T19:58:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                    {"ts":"2026-02-12T19:58:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                    {"ts":"2026-02-12T19:58:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                    {"ts":"2026-02-12T19:58:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                    {"ts":"2026-02-12T19:58:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                ]
            };
            
            try {
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                showResult('sensor', 'success', '‚úÖ Success', formatPrediction(data));
            } catch (error) {
                showResult('sensor', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 3: Environmental Critical
        async function testEnvCritical() {
            showResult('env-critical', 'loading', '‚è≥ Loading...', 'Testing critical environmental conditions...');
            const payload = {
                "asset_id": "pump_high_risk",
                "timestamp": "2026-02-14T14:30:00Z",
                "sensor_window": [
                    {"ts":"2026-02-14T14:28:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                    {"ts":"2026-02-14T14:28:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                    {"ts":"2026-02-14T14:28:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                    {"ts":"2026-02-14T14:28:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                    {"ts":"2026-02-14T14:28:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                ],
                "environmental": {
                    "operating_hours": 2500,
                    "days_since_last_maintenance": 90,
                    "ambient_temperature_c": 48,
                    "ambient_humidity_percent": 88,
                    "load_factor": 0.98,
                    "maintenance_overdue": true
                }
            };
            
            try {
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                showResult('env-critical', 'success', '‚úÖ Success', formatPrediction(data));
            } catch (error) {
                showResult('env-critical', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 4: Environmental Favorable
        async function testEnvFavorable() {
            showResult('env-favorable', 'loading', '‚è≥ Loading...', 'Testing favorable environmental conditions...');
            const payload = {
                "asset_id": "pump_001",
                "timestamp": "2026-02-12T20:00:00Z",
                "sensor_window": [
                    {"ts":"2026-02-12T19:58:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                    {"ts":"2026-02-12T19:58:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                    {"ts":"2026-02-12T19:58:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                    {"ts":"2026-02-12T19:58:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                    {"ts":"2026-02-12T19:58:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                ],
                "environmental": {
                    "operating_hours": 850.5,
                    "days_since_last_maintenance": 25,
                    "ambient_temperature_c": 22.5,
                    "ambient_humidity_percent": 55,
                    "load_factor": 0.75,
                    "maintenance_overdue": false
                }
            };
            
            try {
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                showResult('env-favorable', 'success', '‚úÖ Success', formatPrediction(data));
            } catch (error) {
                showResult('env-favorable', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 5: Image Rust
        async function testImageRust() {
            showResult('image-rust', 'loading', '‚è≥ Loading...', 'Loading rust image and running prediction...');
            try {
                // Load image and convert to base64
                const imageBase64 = await fetchImageAsBase64('../tests/images/rust/rust1.jpg');
                
                const payload = {
                    "asset_id": "pump_visual_001",
                    "timestamp": "2026-02-14T15:00:00Z",
                    "sensor_window": [
                        {"ts":"2026-02-14T14:58:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                        {"ts":"2026-02-14T14:58:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                        {"ts":"2026-02-14T14:58:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                        {"ts":"2026-02-14T14:58:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                        {"ts":"2026-02-14T14:58:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                    ],
                    "image_base64": imageBase64
                };
                
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                
                let html = formatPrediction(data);
                html += '<br><img src="../tests/images/rust/rust1.jpg" class="image-preview" style="max-width: 200px;">';
                
                showResult('image-rust', 'success', '‚úÖ Success', html);
            } catch (error) {
                showResult('image-rust', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 6: Image Clean
        async function testImageClean() {
            showResult('image-clean', 'loading', '‚è≥ Loading...', 'Loading clean image and running prediction...');
            try {
                const imageBase64 = await fetchImageAsBase64('../tests/images/no_rust/clean1.jpg');
                
                const payload = {
                    "asset_id": "pump_visual_002",
                    "timestamp": "2026-02-14T15:30:00Z",
                    "sensor_window": [
                        {"ts":"2026-02-14T15:28:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                        {"ts":"2026-02-14T15:28:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                        {"ts":"2026-02-14T15:28:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                        {"ts":"2026-02-14T15:28:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                        {"ts":"2026-02-14T15:28:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                    ],
                    "image_base64": imageBase64
                };
                
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                
                let html = formatPrediction(data);
                html += '<br><img src="../tests/images/no_rust/clean1.jpg" class="image-preview" style="max-width: 200px;">';
                
                showResult('image-clean', 'success', '‚úÖ Success', html);
            } catch (error) {
                showResult('image-clean', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 7: Multimodal Complete
        async function testMultimodal() {
            showResult('multimodal', 'loading', '‚è≥ Loading...', 'Running complete multimodal prediction...');
            try {
                const imageBase64 = await fetchImageAsBase64('../tests/images/rust/rust2.jpg');
                
                const payload = {
                    "asset_id": "pump_multimodal",
                    "timestamp": "2026-02-14T16:00:00Z",
                    "sensor_window": [
                        {"ts":"2026-02-14T15:58:00Z","sensor_00":0.1,"sensor_01":0.2,"sensor_02":0.3},
                        {"ts":"2026-02-14T15:58:10Z","sensor_00":0.2,"sensor_01":0.1,"sensor_02":0.4},
                        {"ts":"2026-02-14T15:58:20Z","sensor_00":0.15,"sensor_01":0.25,"sensor_02":0.35},
                        {"ts":"2026-02-14T15:58:30Z","sensor_00":0.18,"sensor_01":0.22,"sensor_02":0.31},
                        {"ts":"2026-02-14T15:58:40Z","sensor_00":0.21,"sensor_01":0.19,"sensor_02":0.33}
                    ],
                    "environmental": {
                        "operating_hours": 1800,
                        "days_since_last_maintenance": 60,
                        "ambient_temperature_c": 35,
                        "ambient_humidity_percent": 75,
                        "load_factor": 0.85,
                        "maintenance_overdue": false
                    },
                    "image_base64": imageBase64
                };
                
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                
                let html = formatPrediction(data);
                html += '<br><img src="../tests/images/rust/rust2.jpg" class="image-preview" style="max-width: 200px;">';
                
                showResult('multimodal', 'success', '‚úÖ Success', html);
            } catch (error) {
                showResult('multimodal', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 8: VLM Multimodal (CLIP)
        async function testVLMMultimodal() {
            showResult('vlm-multimodal', 'loading', '‚è≥ Loading...', 'Running VLM multimodal prediction with CLIP model...');
            try {
                // Use clean image to demonstrate VLM false positive issue
                const imageBase64 = await fetchImageAsBase64('../tests/images/no_rust/clean2.jpg');
                
                const payload = {
                    "asset_id": "pump_vlm_test",
                    "timestamp": "2026-02-15T14:30:00Z",
                    "sensor_window": [
                        {"ts":"2026-02-15T14:28:00Z","sensor_00":0.12,"sensor_01":0.18,"sensor_02":0.25},
                        {"ts":"2026-02-15T14:28:10Z","sensor_00":0.15,"sensor_01":0.20,"sensor_02":0.28},
                        {"ts":"2026-02-15T14:28:20Z","sensor_00":0.13,"sensor_01":0.19,"sensor_02":0.26},
                        {"ts":"2026-02-15T14:28:30Z","sensor_00":0.14,"sensor_01":0.21,"sensor_02":0.27},
                        {"ts":"2026-02-15T14:28:40Z","sensor_00":0.16,"sensor_01":0.22,"sensor_02":0.29}
                    ],
                    "environmental": {
                        "operating_hours": 950.5,
                        "days_since_last_maintenance": 18,
                        "ambient_temperature_c": 23.5,
                        "ambient_humidity_percent": 58,
                        "load_factor": 0.72,
                        "maintenance_overdue": false
                    },
                    "image_base64": imageBase64
                };
                
                const response = await fetch(`${getBaseUrl()}/predict`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                
                let html = formatPrediction(data);
                html += '<br><div style="margin-top: 10px; padding: 10px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">';
                html += '<strong>‚ö†Ô∏è VLM Note:</strong> This test uses a <strong>clean pump image</strong>. ';
                html += 'If CLIP model is active, it may show false positive (rust detected on clean surface). ';
                html += 'See <a href="../docs/VLM_EVALUATION.md" target="_blank">VLM_EVALUATION.md</a> for details.';
                html += '</div>';
                html += '<br><img src="../tests/images/no_rust/clean2.jpg" class="image-preview" style="max-width: 200px; border: 2px solid #10b981;">';
                html += '<div style="text-align: center; color: #10b981; font-size: 12px; margin-top: 5px;">‚úÖ Clean pump (no rust)</div>';
                
                showResult('vlm-multimodal', 'success', '‚úÖ Success', html);
            } catch (error) {
                showResult('vlm-multimodal', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Test 9: Batch Prediction
        async function testBatch() {
            showResult('batch', 'loading', '‚è≥ Loading...', 'Processing batch of 3 assets...');
            try {
                // Load sample batch JSON
                const response = await fetch('../samples/batch.json');
                const payload = await response.json();
                
                const startTime = performance.now();
                const batchResponse = await fetch(`${getBaseUrl()}/predict/batch`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                const data = await batchResponse.json();
                const elapsed = (performance.now() - startTime).toFixed(1);
                
                let html = `<strong>Processed:</strong> ${data.results.length} assets in ${elapsed}ms<br><br>`;
                data.results.forEach((result, idx) => {
                    html += `<strong>Asset ${idx + 1} (${result.asset_id}):</strong><br>`;
                    html += `&nbsp;&nbsp;Failure Prob: ${(result.failure_probability * 100).toFixed(1)}%, `;
                    html += `TTB: ${result.estimated_time_to_breakdown_hours.toFixed(0)}h`;
                    if (result.predicted_fault_type) {
                        html += `, Fault: ${result.predicted_fault_type}`;
                    }
                    html += '<br>';
                });
                
                showResult('batch', 'success', '‚úÖ Success', html);
            } catch (error) {
                showResult('batch', 'error', '‚ùå Error', error.message);
            }
        }
        
        // Helper: Fetch image as base64
        async function fetchImageAsBase64(url) {
            const response = await fetch(url);
            const blob = await response.blob();
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }
        
        // Run all tests sequentially
        async function runAllTests() {
            await testHealth();
            await new Promise(r => setTimeout(r, 500));
            await testSensorOnly();
            await new Promise(r => setTimeout(r, 500));
            await testEnvCritical();
            await new Promise(r => setTimeout(r, 500));
            await testEnvFavorable();
            await new Promise(r => setTimeout(r, 500));
            await testImageRust();
            await new Promise(r => setTimeout(r, 500));
            await testImageClean();
            await new Promise(r => setTimeout(r, 500));
            await testMultimodal();
            await new Promise(r => setTimeout(r, 500));
            await testBatch();
        }
        
        // Auto-check health on load
        window.addEventListener('load', checkHealth);
    </script>
</body>
</html>
